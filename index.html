<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Git como estilo de vida</title>
    
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/extra.css">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/moon.css">
    
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css">
    
    <!-- Printing and PDF exports -->
    <script>
     var link = document.createElement( 'link' );
     link.rel = 'stylesheet';
     link.type = 'text/css';
     link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
     document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">

        
	<section
          data-background='https://live.staticflickr.com/65535/48754260812_c9f7d3420b_k_d.jpg'>
          <h1><code>git</code> como estilo de vida</h1>
	  <h1><code>#WCDevSevilla19</code></h1>
        </section>

	<section data-background='img/Camelia.svg'>
	  <h2><code>@jjmerelo</code> | <code>github.com/JJ</code></h2>
	  <h1 class='fragment'><em>Documentator</em> en Raku/Perl 6</h1>
 	</section>

        <section> <!-- qué es -->
	        <section><h1><code>git</code> es</h1></section>
                

                <section data-background='https://camo.githubusercontent.com/0192ca0db25d3489a1bfa6f96471e04aba03482d/68747470733a2f2f6661726d312e737461746963666c69636b722e636f6d2f3730312f33313738323738383932365f303739386634656230625f6b5f642e6a7067'>
                <h1>Sistema de ficheros
                  direccionado por contenido</h1>
                </section>

                <section
                data-background='https://live.staticflickr.com/8538/29969478425_cce55cff9c_o_d.jpg'><h1>Con
                  un sistema de gestión de versiones encima</h1>
                </section>

                <section data-background='https://camo.githubusercontent.com/823606b63fa5b5ae1d6249ae55701cf51eb59825/68747470733a2f2f6661726d392e737461746963666c69636b722e636f6d2f383632332f31363133333937343134395f343032626462336630365f625f642e6a7067'><h1>Sistema de eventos</h1>
                  <h2 class='fragment'>Gestor de flujos de
                    trabajo configurable</h2>
                </section>

                <section
                  data-background='https://camo.githubusercontent.com/eef6d91b41894ab0c9b505149b249e0aa75a75f2/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353130342f353638313435303230365f303131663838376333355f625f642e6a7067'><h1>Imprescindible</h1>
                  <h2 class='fragment'>Con
                    GitHub/GitLab/BitBucket</h2>
                <aside class='notes'>GitHub (y GitLab) aportan un
                marco de aplicaciones de flujos de trabajo, que se
                pueden usar con gran provecho para automatizar tareas
                  y mejorar la productividad.</aside>
                </section>
              </section>

              <section> <!-- Plantillas -->
                <section>
                  <h1>Plantillas FTW</h1>
                  <img src='img/plantillas.png' alt='Plantillas en
                       GitHub' />
                  <aside class='notes'>Usarlo con GitHub es cada vez
                más productivo y útil. Las plantillas son un mecanismo
                    de GitHub para crear repositorios con tu contenido
                    inicial. Posiblemente uséis VVV, y es posible que haya
                    cosas que no os sirvan. En esta plantilla elimina dos
                    o tres cosas que no hacen falta en un entorno local,
                    pero tú puedes crear tu propia versión con todo lo que
                    necesites (cambio de máquina virtual, por ejemplo) e
                    inicializar tus repositorios todas las veces que
                quieras. Las plantillas también están en <a
                href='https://docs.gitlab.com/ee/user/admin_area/settings/instance_template_repository.html'>GitLab,
                    pero sólo en premium, y para ficheros. Estas
                plantillas <a
                href='https://github.blog/2019-06-06-generate-new-repositories-with-repository-templates/'>se
                    introdujeron en junio de este año</a></a>.
                  </aside>
                </section>
                
                <section data-background='https://live.staticflickr.com/4859/39668359203_d806015b0d_k_d.jpg'>
                  <h1>Simplemente marca la casilla</h1>
                  <img src='img/casilla.png' alt='marca la casilla'>
                </section>

                <section data-background='img/trellis-template.png'>
                  <h1><code>git.io/jj-tt</code></h1>

                  <aside class='notes'>Simplemente siguiendo las
                instrucciones de Trellis, se crea esta plantilla, de
                forma que puedes empezar a trabajar directamente. La
                plantilla está en un repo, así que puedes hacerla
                    evolucionar según necesites más o menos cosas. Hay
                un trellis-cli que hace cosas, pero requiere go, por
                ejemplo. Esto es simplemente una plantilla que puedes
                usar directamente desde GitHub.</aside>
                </section>

              </section>

              <section> <!-- Yendo más allá con GitHub -->
                <section
                data-background='https://live.staticflickr.com/65535/48832687302_29e47b7f5b_k_d.jpg'><h1>GitHub
                  tiene un API</h1>
                  <aside class='notes'>Hecho conocido, pero algo que
                podemos usar para nuestro provecho. Está enganchado al
                sistema de eventos de git, pero no sólo: incluye
                    también comentarios y todo lo que suceda en general en él.</aside>
                </section>

                <section data-background='img/github-action.png'>
                  <h1>Eventos causan <em>actions</em></h1>
                </section>

                <section><h3><code>.github/workflows/label.yml</code></h3>
                  <pre><code>name: Labeler
on: [pull_request]

jobs:
  label:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/labeler@v2
      with:
        repo-token: "${{ secrets.GITHUB_TOKEN }}"
                  </code></pre>

                  <aside class='notes'>Las acciones de GitHub se
                conectan simplemente metiéndolas en el directorio
                    correspondiente. Se activa con un evento que
                figura en <code>on</code>, y ejecuta una serie de
                trabajos, que a su vez se ejecutan en una serie de
                pasos. Esas acciones pueden usar el API de GitHub,
                como se ve aquí: tienen una serie de variables de
                entorno que se pueden añadir directamente al
                programa. El programa, a continuación, las usará para
                    acceder al API de forma segura. Esta es una acción incluida en el sitio de VVV (borrada de la plantilla, por cierto).</aside>
                </section>

                <section><h1>Github <em>Actions</em> está en beta</h1>
                  <img src='img/github-action-menu.png'>
                  <aside class='notes'>Ya están activadas en ciertos
                  repositorios, pero si quieres usarlas tú en los
                  tuyos tendrás que solicitar el acceso a la beta. Lo
                    suelen dar, sin embargo, sin mucha
                    alharaca.</aside>
                </section>

                <section>
                  <h2>Algunos ficheros son importantes</h2>
                  <pre><code>name: "Comprueba presencia de ficheros"
on: [pull_request, push]

jobs:
  file_presence:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: "Comprueba ficheros importantes"
        uses: JJ/files-present-action@releases/v1
        with:
          files: "version, Vagrantfile, vvv-config.yml"
                  </code></pre>

                  <aside class='notes'>Aquí encadenamos dos acciones:
                una del propio GitHub que descarga el repo localmente
                (las actions no actúan sobre el repo necesariamente,
                por eso hace falta descargalo con una action) y a
                    continuación comprueba los ficheros; en la charla de Ansible hemos visto como se puede usar Ansible para comprobar este tipo de cosas; pero eso va junto con todo el script de despliegue. Una action puede comprobarlo sobre la marcha, simplemente cuando se hace push a GitHub.</aside>
                </section>

                <section><h1>Stuff happens</h1>
                  <img src='img/delete-version.png' alt='Deletes version'>

                </section>

                <section><h1>Echa el freno, Macareno</h1>
                  <img src='img/action-aborted.png' alt='busted'>
                </section>

                <section data-background='img/action-aborted-busted.png'>
                  <aside class='notes'>Útil sobre todo en PRs, pero
                  también en todo tipo de cosas, desde un push (si hay
                  varios participantes) hasta etiquetado automático de
                  issues o, en realidad, cualquier cosa como
                    reorganizar el código</aside>
                 </section>

                 <section>
                   <pre><code>import * as core from '@actions/core';
import fs from 'fs';
async function run() {
  try {
      const files = core.getInput('files')
      const fileList = files.split(/,\s+/)
      var doesntExist: string[] = []
      fileList.forEach( function( file ) {          
          if ( ! fs.existsSync(file) ) {
              doesntExist.push( file )
          }
      })
      if (doesntExist.length > 0 ) {
	core.setFailed( "These files do not exist: "
	    + doesntExist.join( ", " ) )
      }
  } catch (error) { //       core.setFailed(error.message);
  }
}
run();</code></pre>                 
		   <aside class='notes'>Pero puede que no tengas acceso a la beta (aunque supongo que en poco lo tendrá todo el mundo, y quieres pasar los tests locales</aside>
                 </section>
              </section>

              <section><!-- Pero no puedo acceder a actions -->
		<section data-background='https://live.staticflickr.com/65535/48847315062_e959f270b7_k_d.jpg'><h1>Quiero mis propios tests.</h1>
		  <h1 class='fragment'>Usemos ganchos</h1>
		</section>
		
                <section><h1>Los estándares WPC son importantes</h1>
                  <aside class='notes'>Estándares que debería seguir
                    un proyecto, <a
                href='https://packagist.org/packages/wp-coding-standards/wpcs'>aquí</a>
                  </aside>
                </section>

                <section data-background='https://live.staticflickr.com/8386/8519896461_b47ded041a_o_d.jpg'><h1>Usa un <em>gancho</em> local</h1>
                  <h2 class='fragment'>Usa bibliotecas tales como <a
                    href='https://github.com/claudiosanches/wp-git-hooks'><code>wp-git-hooks</code>
                  </a>
                  </h2>
                </section>

                <section><h2>¿Dónde está la chicha? <code>pre-commit</code></h2>
                  <pre><code>STAGED_FILES_CMD=`git diff --cached --name-only --diff-filter=ACMR HEAD | grep \\\\.php`
# Más cosas...
SFILES=${SFILES:-$STAGED_FILES_CMD}
# Más cosas...
if [ "$FILES" != "" ]; then
  echo "Running Code Sniffer."
  ./vendor/bin/phpcs --encoding=utf-8 -n -p $FILES
  if [ $? != 0 ]; then
    echo "Fix the error before commit!"
    echo "Run"
    echo "  ./vendor/bin/phpcbf $FILES"
    echo "for automatic fix or fix it manually."
    exit 1
  fi
fi
                  </code></pre>
              </section>

              <section><h1>Plantillas de repositorio</h1>
                <img src='img/git-template.png' alt='Plantilla de repo'>
              </section>

              <section><h1>Doble plantilla FTW</h1>
                <pre><code>git clone WP-talk-test --template=/home/jmerelo/Code/repo-plantilla</code></pre>
                <img src='img/ejecucion-template.png' alt='ejecuta template'>
              </section>

              </section>

              <section data-background='https://live.staticflickr.com/1438/1240116506_f4ab6cfe40_k_d.jpg'>
                <h1>Automatiza tus flujos de trabajo con Git y
                GitHub</h1></section>
              <section data-background='https://live.staticflickr.com/28/55633893_0f9913e058_k_d.jpg'><h1>¡Mira! ¡Sin código!</h1></section>
              <section
                data-background='https://live.staticflickr.com/65535/48809313556_2d6dff09b5_k_d.jpg'><h1>Vive
                tu <code>git</code></h1>
                <h2 class='fragment'><code>git commit -am "Tu vida"</code></h2>
              </section>
              
              
	    </div>
	  </div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
		 Reveal.initialize({
                   width: '95%',
                   controls: true,
                   progress: true,
                   history: true,
		   dependencies: [
		     { src: 'plugin/notes/notes.js', async: true },
		     { src: 'plugin/highlight/highlight.js', async: true }
		   ]
		 });
		</script>
	</body>
</html>
